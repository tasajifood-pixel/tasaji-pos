<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Tasaji POS</title>
<link rel="icon" type="image/png" href="favicon.png?v=2">
<link rel="shortcut icon" href="favicon.png?v=2">

<!-- =====================================================
     SUPABASE SDK
===================================================== -->

<link rel="stylesheet" href="./style.css ">
<link rel="manifest" href="./manifest.webmanifest">

</head>

<body>
<!-- ===============================
     WELCOME SCREEN (PILIH KASIR)
================================ -->
<div id="welcomeScreen" style="
  position:fixed;
  inset:0;
  background:#f5f5f7;
  z-index:99999;
  display:flex;
  align-items:center;
  justify-content:center;
">
  <div style="
    background:#fff;
    padding:30px;
    border-radius:16px;
    width:360px;
    max-width:90%;
    text-align:center;
    box-shadow:0 10px 30px rgba(0,0,0,.15);
  ">
    <h2 style="margin-top:0;">ğŸ‘‹ Selamat Datang</h2>
    <p style="color:#666;margin-bottom:20px;">
      POS Tasaji Food<br>
      Silakan pilih identitas Anda
    </p>
<button class="btn-cashier">
  Rifqi â€” Kasir 01
</button>

<button class="btn-cashier">
  Inan â€” Kasir 02
</button>

<button class="btn-cashier">
  Imad â€” Kasir 03
</button>

<button class="btn-cashier">
  Ahmad â€” Kasir 04
</button>
  </div>
</div>

<div class="pos-wrapper">

<header class="pos-header">
  <div class="pos-header-left">ğŸ§¾ Tasaji POS</div>

  <div class="pos-header-right">
    <span id="cashierInfo" style="margin-right:10px;font-size:12px;color:#666;"></span>
    <button id="btnSwitchCashier" style="
      border:none;
      background:#eee;
      padding:6px 10px;
      border-radius:6px;
      cursor:pointer;
      font-size:12px;
    ">
      ğŸ” Ganti Kasir
    </button>
  </div>
</header>


<main class="pos-main">

  <!-- ================= LEFT (DINAMIS) ================= -->
  <div class="left-panel">

    <!-- SIDEBAR TAB -->
   <aside class="left-tabs">

  <!-- ===== MENU ATAS ===== -->
  <div class="left-tabs-menu">
    <button class="tab-btn active" id="tabSales">
      <div class="ico">ğŸ›’</div>
      <div>Jual</div>
    </button>

    <button class="tab-btn" id="tabTxn">
      <div class="ico">ğŸ“„</div>
      <div>Trans</div>
    </button>

    <button class="tab-btn" id="tabSet">
      <div class="ico">âš™ï¸</div>
      <div>Setting</div>
    </button>

    <button class="tab-btn" id="tabPrice">
      <div class="ico">ğŸ’°</div>
      <div>Cek</div>
    </button>

    <button class="tab-btn" id="tabReport">
      <div class="ico">ğŸ“Š</div>
      <div>Laporan</div>
    </button>

    <button class="tab-btn" id="tabPiutang">
      <div class="ico">ğŸ’²</div>
      <div>Piutang</div>
    </button>
  </div>

  <!-- ===== FOOTER BAWAH ===== -->
  <div class="left-tabs-footer">
    <button class="tab-btn logout-btn">
  <div class="ico">â»</div>
  <div>Logout</div>
</button>

  </div>

</aside>


    <div class="left-content">

     <!-- =================================================
     PANEL PRODUK
================================================== -->
<section class="product-panel" id="panel-product">
  <div class="product-toolbar">
  <div class="search-input">
    <input id="searchInput" placeholder="Cari nama / kode / barcode">
  </div>

  <button class="btn btn-cari" id="btnCari">Cari</button>

</div>


<!-- SORT PRODUK -->
<!-- SORT PRODUK -->
<div class="product-sort" id="productSort">

  <div class="sort-main">
    <button class="sort-btn active" data-sort="best">ğŸ”¥ Terlaris</button>
    <button class="sort-btn" data-sort="latest">ğŸ•’ Terbaru</button>
    <button class="sort-btn" data-sort="az">Aâ€“Z</button>
  </div>

  <!-- PERIODE TERLARIS (muncul hanya saat pilih Terlaris) -->
  <div class="sort-period" id="bestPeriodBox">
    <button class="period-btn active" data-period="7d">7 Hari</button>
    <button class="period-btn" data-period="30d">30 Hari</button>
    <button class="period-btn" data-period="90d">90 Hari</button>
    <button class="period-btn" data-period="180d">6 Bulan</button>
    <button class="period-btn" data-period="365d">1 Tahun</button>
  </div>

</div>



  <div id="productGrid" class="product-grid"></div>

  <div id="pagination" style="text-align:center;margin-top:8px">
    <button id="prevPage" class="btn">Prev</button>
    <span id="pageInfo"></span>
    <button id="nextPage" class="btn">Next</button>
  </div>
</section>


      <!-- =================================================
           PANEL PAYMENT
      ================================================== -->
      <section class="payment-page" id="panel-payment" style="display:none">
        <div class="payment-wrapper">
          <div class="payment-left">

  <!-- âœ… TAMBAH: wrapper scroll -->
  <div class="payment-scroll">

    <h2>Ringkasan Pembayaran</h2>

    <div class="pay-summary">
      <div class="row">
        <span>Total Item</span>
        <strong id="payItemCount">0</strong>
      </div>
      <div class="row">
        <span>Total Bayar</span>
        <strong id="payTotal">Rp 0</strong>
      </div>
    </div>

    <div id="payLinesBox" style="
      margin-top:14px;
      border:1px solid #eee;
      border-radius:10px;
      overflow:hidden;
    ">
      <div id="payLinesList"></div>

      <div style="
        display:flex;
        justify-content:space-between;
        padding:10px 12px;
        border-top:1px solid #eee;
        background:#fafafa;
        font-size:13px;
      ">
        <span>Sisa</span>
        <strong id="payRemaining">Rp 0</strong>
      </div>
    </div>

    <div class="pay-method">
      <label>Metode Pembayaran</label>
      <div class="pay-method-grid">
        <button class="pay-method-btn" data-method="cash">ğŸ’µ Tunai</button>
        <button class="pay-method-btn" data-method="debit_bca">ğŸ¦ Debit BCA</button>
        <button class="pay-method-btn" data-method="debit_mandiri">ğŸ¦ Debit Mandiri</button>
        <button class="pay-method-btn" data-method="qris_gopay">ğŸ“± QRIS GoPay</button>
        <button class="pay-method-btn" data-method="transfer_bca">ğŸ” Transfer BCA</button>
		 <button class="pay-method-btn" data-method="transfer_mandiri">ğŸ” Transfer Mandiri</button>
        <button class="pay-method-btn" data-method="piutang">â³ğŸ’°Piutang</button>
      </div>
    </div>

    <div class="quick-cash" id="quickCash" style="display:none; margin-top:12px; gap:10px;">
      <button class="btn" type="button">Sama</button>
      <button class="btn" type="button">Rp50.000</button>
      <button class="btn" type="button">Rp100.000</button>
    </div>

    <div class="pay-input" style="margin-top:16px;">
      <label>Uang Diterima</label>
      <input type="number" id="cashInput" placeholder="Masukkan nominal"
        style="width:100%;padding:10px;font-size:15px;margin-top:6px;" />
    </div>

    <div class="pay-change">
      Kembalian: <strong id="changeOutput">Rp 0</strong>
    </div>

   </div> <!-- âœ… END wrapper scroll -->

  <div class="pay-footer-row">
  <!-- === WA RECEIPT OPTION (TAHAP 1) === -->
<div id="waReceiptOption" style="margin:10px 0;">
  <label style="cursor:pointer;">
    <input type="checkbox" id="chkSendWaReceipt">
    Kirim Nota via WhatsApp
  </label>
</div>


<!-- === WA PHONE INPUT (TAHAP 5) === -->
<div id="waPhoneBox" style="display:none; margin:10px 0;">
  <label style="display:block; cursor:default; font-weight:700; margin-bottom:6px;">
    No WhatsApp (untuk pelanggan umum)
  </label>

  <input
    type="tel"
    id="waPhoneInput"
    placeholder="Contoh: 62812xxxxxxx (tanpa +, tanpa spasi)"
    style="width:100%; padding:10px; font-size:15px;"
    autocomplete="tel"
  />

  <div style="font-size:12px; color:#666; margin-top:6px;">
    Jika input mulai 0 atau 8, nanti dinormalisasi jadi format 62xxxxxxxxxxx.
  </div>
</div>

    <button id="btnFinishPayment" class="btn-pay disabled" disabled>
      Selesaikan Transaksi
    </button>
  </div>

</div> <!-- tutup payment-left -->
</div> <!-- âœ… tutup payment-wrapper -->
</section>


      <!-- =================================================
           PANEL TRANSAKSI
      ================================================== -->
      <section class="txn-panel" id="panel-transactions">
        <div class="txn-toolbar">

  <!-- SEARCH -->
  <div class="search-input">
    <input id="txnSearchInput" placeholder="Cari No Order / Nama / Telepon">
  </div>

  <!-- FILTER -->
  <div class="txn-filter">

    <span class="txn-label">Tanggal</span>

    <div class="txn-date-range">
      <input type="date" id="txnDateFrom" />
      <span class="txn-sep">â€“</span>
      <input type="date" id="txnDateTo" />
    </div>

    <div class="txn-quick">
      <button class="btn-outline" type="button" id="btnTxnToday">Hari Ini</button>
      <button class="btn-outline" type="button" id="btnTxnYesterday">Kemarin</button>
    </div>

    <select id="txnCashierFilter">
      <option value="ALL">Semua Kasir</option>
      <option value="ACTIVE">Kasir Aktif Saja</option>
    </select>

    <!-- âœ… METODE PEMBAYARAN PINDAH KE TRANSAKSI -->
    <select id="txnPayFilter">
      <option value="ALL">Semua Metode</option>
      <option value="CASH">Cash</option>
      <option value="QRIS">QRIS</option>
      <option value="DEBIT">Debit</option>
      <option value="TRANSFER">Transfer</option>
      <option value="PIUTANG">Piutang</option>
    </select>

  </div>

  <!-- ACTIONS -->
  <div class="txn-actions">
    <button class="btn btn-cari" id="btnTxnCari">Cari</button>
    <button class="btn btn-refresh" id="btnTxnRefresh" title="Refresh">â†»</button>
  </div>

</div>


        <div class="txn-body">
          <div class="txn-list">
            <div class="txn-list-head" id="txnListHead">
  <div id="txnHeadTitle">Daftar Transaksi</div>
  <div id="txnCountInfo" style="font-size:12px;color:#666;margin-top:4px;">
    Total: 0 transaksi
  </div>
</div>

            <div class="txn-list-items" id="txnList"></div>
            <div style="padding:10px 12px; border-top:1px solid #eee; background:#fafafa; display:flex; gap:8px;">
              <button class="btn" style="flex:1">Prev</button>
              <button class="btn" style="flex:1">Next</button>
            </div>
          </div>

          <div class="txn-detail">
            <div class="txn-detail-head">
              <div>
                <div class="txn-detail-title" id="txnDetailTitle">Pilih transaksi</div>
                <div class="txn-detail-sub" id="txnDetailSub">Klik salah satu transaksi di kiri</div>
              </div>
              <div id="txnDetailBadge"></div>
            </div>

            <div class="txn-detail-body" id="txnDetailBody">
              <div style="color:#999;">Belum ada data.</div>
            </div>

            <div class="txn-actions" id="txnDetailActions" style="display:none;">
  <button class="btn-outline" onclick="txnReprintReceipt()">ğŸ–¨ Print</button>

  <button class="btn-danger" id="btnTxnCancel" onclick="txnCancelTransaction()">â›” Cancel</button>
  <button class="btn-primary" onclick="txnReorder()">ğŸ” Reorder</button>
  <button class="btn-outline" onclick="txnResendWaReceipt()">ğŸ“©Struk Wa</button>
</div>


          </div>
        </div>
      </section>

      <section class="settings-panel" id="panel-settings">
  <div class="settings-two-col">

    <!-- KIRI: STRUK -->
    <div class="set-card struk-card">
      <h3>Struk</h3>

      <div class="set-row">
        <label>Ukuran kertas</label>
        <select id="setReceiptPaper">
          <option value="80">80 mm</option>
          <option value="58">58 mm</option>
        </select>
      </div>

      <div class="set-row">
        <label>Nama Toko</label>
        <input type="text" id="setStoreName">
      </div>

      <div class="set-row">
        <label>Sub Header</label>
        <input type="text" id="setStoreSub">
      </div>

      <div class="set-block">
        <label>Catatan Struk 1</label>
        <textarea id="setNote1" rows="2"></textarea>
      </div>

      <div class="set-block">
        <label>Catatan Struk 2</label>
        <textarea id="setNote2" rows="2"></textarea>
      </div>

      <div class="set-row">
        <label>ShiftX Struk (mm)</label>
        <input type="number" id="setShiftX" step="0.1">
      </div>

      <div class="small-note">
        Kiri kepotong â†’ <b>-0.5</b> Â· Terlalu kosong â†’ <b>+0.5</b>
      </div>
    </div>

    <!-- KANAN: FILTER (ATAS) + SINKRON (BAWAH) -->
    <div class="right-stack">

      <div class="set-card">
        <h3>Filter Penjualan</h3>

        <label class="set-check">
          <input type="checkbox" id="setHideEmpty">
          <span>Sembunyikan stok habis</span>
        </label>

        <label class="set-check">
          <input type="checkbox" id="setRequireStock">
          <span>Akuisisi stok (wajib ada stok)</span>
        </label>

        <label class="set-check">
          <input type="checkbox" id="setHideKtn">
          <span>Sembunyikan â€œKtnâ€</span>
        </label>

        <div class="small-note">
          Sinkron dengan checkbox di tab Penjualan.
        </div>
      </div>

      <div class="set-card">
        <h3>Sinkronisasi Produk</h3>
        <div class="set-row">
          <label>Auto Sync (jam)</label>
          <input type="number" id="setAutoSyncHours" min="1">
        </div>
	

        <div class="small-note">
          Otomatis sync jika cache lebih lama dari jam ini.
        </div>
        <button class="btn-primary">
          ğŸ”„ Sync Sekarang
        </button>

        <div id="syncStatus" class="sync-status"></div>
      </div>
	  <div class="set-card">
  <h3>Admin</h3>
  <div class="small-note">
    Khusus admin. Perlu PIN.
  </div>
  <button class="btn-admin-cleanup" type="button" onclick="openCleanupCanceledModal()">
  <span class="ico">ğŸ§¹</span>
  <span>Bersihkan Pesanan Dibatalkan</span>
</button>

</div>
    </div>
  </div>
</section>
<!-- =================================================
     PANEL LAPORAN
================================================== -->
<section class="report-panel" id="panel-report" style="display:none">
  <div class="set-card">
    <h3>Laporan Singkat</h3>

    <div class="set-row" style="flex-wrap:wrap; justify-content:flex-start; padding:6px 0;">

      <div style="display:flex; align-items:center; gap:10px; flex-wrap:wrap;">
        <div style="font-size:13px; color:#333; font-weight:700;">Tanggal</div>

        <input type="date" id="reportDateFrom" style="width:170px;" />
<span style="font-weight:700;">â€“</span>
<input type="date" id="reportDateTo" style="width:170px;" />


        <button class="btn-outline" type="button">Hari Ini</button>
<button class="btn-outline" type="button">Kemarin</button>


<select id="reportCashierFilter" style="width:220px;">
  <option value="ALL">Semua Kasir</option>
  <option value="ACTIVE">Kasir Aktif Saja</option>
</select>


      </div>
    </div>


  </div>

  <div style="display:grid; grid-template-columns: 1fr; gap:16px;">


  <div class="set-card">
   <h3 style="text-align:center; margin-bottom:12px;">Ringkasan</h3>

    <div id="reportSummary"
  style="
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap:12px;
    width:100%;
  ">
</div>


  </div>


</div>


  <div class="set-card" id="reportByCashierCard" style="width:100%;">
<h3 style="text-align:center; margin-bottom:12px;">Rincian Per Kasir</h3>

  <div id="reportByCashier"></div>
</div>

</section>

<!-- =================================================
     PANEL PIUTANG MONITOR
================================================== -->
<section class="txn-panel" id="panel-piutang" style="display:none">
  <div class="txn-toolbar">
    <div id="piutangHeadTitle" style="font-weight:800; font-size:14px;">
      Piutang Monitor
    </div>
    <div id="piutangCountInfo" style="font-size:12px;color:#666; margin-top:4px;">
      Total: 0 piutang
    </div>
<div id="piutangTotalInfo" style="font-size:12px;color:#111; margin-top:2px; font-weight:700;">
  Total Piutang: Rp 0
</div>
    <div class="txn-filter" style="margin-left:auto;">
      <select id="piutangSort">
        <option value="oldest">Terlama</option>
        <option value="newest">Terbaru</option>
        <option value="largest">Terbesar</option>
        <option value="smallest">Terkecil</option>
      </select>
      <button class="btn btn-refresh" id="btnPiutangRefresh" title="Refresh">â†»</button>
    </div>
  </div>

  <div class="txn-body">
    <div class="txn-list" style="width:100%;">
      <div class="txn-list-items" id="piutangList"></div>
    </div>
  </div>
</section>
    </div>
  </div>

  <!-- ================= RIGHT (TETAP) ================= -->
  <section class="cart-panel">
<div class="cart-header" style="
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:8px;
  padding-bottom:8px;
">
  <div style="display:flex; gap:6px; flex-wrap:wrap;">
    <button class="btn-outline" onclick="openHoldModal()">ğŸ—‚ Tersimpan</button>
    <button class="btn-outline" onclick="parkCurrentOrder()">ğŸ’¾ Simpan</button>
  </div>

  <!-- âœ… AREA TOMBOL TAMBAHAN (DRAFT) -->
  <div style="display:flex; gap:6px; flex-wrap:wrap; justify-content:flex-end; flex:1;">
    <button class="btn-outline" id="btnDraftCart" title="Draft (sebelum bayar)">ğŸ§¾ Draft</button>
<button class="btn-outline" id="btnGudangList" title="List Gudang (tanpa harga)">ğŸ“¦ Picking List</button>

  </div>

  <button class="cart-reset">Reset</button>
</div>




    <div class="cart-customer" style="position:relative">
      <label>Customer (opsional)</label>

      <input
  id="customerInput"
  type="text"
  placeholder="Customer (kosong = UMUM)"
  class="customer-search-input"
/>


      <div id="customerDropdown" class="customer-dropdown"></div>

    </div>

    <div id="cartItems" class="cart-items">
      <div style="color:#999;text-align:center">Belum ada transaksi</div>
    </div>

    <div style="text-align:right; margin-bottom:8px;">
      <button class="btn-back" style="padding:8px 12px;">
        ğŸ›’ Ubah Transaksi
      </button>
    </div>

    <div class="cart-summary" style="margin-top:8px;">
      <div class="summary-row">
        <span>Sub Total (<span id="itemCount">0</span> Barang)</span>
        <span id="cartSubtotal">Rp 0</span>
      </div>
      <div class="summary-row total">
        <span>Total Bayar</span>
        <span id="cartTotal">Rp 0</span>
      </div>
    </div>

   <button id="btnNext" class="btn-primary" style="width:100%;margin-top:8px;">
  Selanjutnya
</button>
  </section>


</main>

</div>

<!-- =====================================================
     STRUK TRANSAKSI (POPUP)
===================================================== -->
<div id="receiptModal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  z-index:9999;
">
  <div id="receiptContent" style="
    background:#fff;
    font-family:monospace;
    box-sizing:border-box;
  ">
  </div>
</div>
<!-- =====================================================
     DRAFT (SEBELUM BAYAR) - POPUP
===================================================== -->
<div id="draftModal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  z-index:10000;
  align-items:center;
  justify-content:center;
  padding:18px;
">
  <div id="draftCard" style="
    width:420px;
    max-width:95vw;
    background:#fff;
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
    font-family: monospace;
  ">
    <div style="
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      background:#fafafa;
      border-bottom:1px solid #eee;
    ">
<!-- âœ… Biar judul tidak turun baris & rapi seperti Picking List -->
<div style="
  font-weight:800;
  flex:1;
  min-width:0;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
">ğŸ§¾ Draft (Belum Dibayar)</div>

<div style="display:flex; gap:8px; flex-wrap:nowrap; flex-shrink:0;">

        <button class="btn-outline" id="btnDraftCopy">ğŸ“‹ Copy</button>
        <button class="btn-outline" id="btnDraftPrint">ğŸ–¨ Print</button>
        <button class="btn-outline" id="btnDraftClose">Tutup</button>
      </div>
    </div>

    <div id="draftContent" style="padding:12px;"></div>
  </div>
</div>
<!-- =====================================================
     LIST GUDANG (PICKING) - POPUP
===================================================== -->
<div id="gudangModal" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  z-index:10000;
  align-items:center;
  justify-content:center;
  padding:18px;
">
  <div id="gudangCard" style="
    width:420px;
    max-width:95vw;
    background:#fff;
    border-radius:14px;
    overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,.25);
    font-family: monospace;
  ">
    <div style="
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      background:#fafafa;
      border-bottom:1px solid #eee;
    ">
      <div style="font-weight:800;">ğŸ“¦ Picking List</div>
      <div style="display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn-outline" id="btnGudangCopy">ğŸ“‹ Copy</button>
        <button class="btn-outline" id="btnGudangPrint">ğŸ–¨ Print</button>
        <button class="btn-outline" id="btnGudangClose">Tutup</button>
      </div>
    </div>

    <div id="gudangContent" style="padding:12px;"></div>
  </div>
</div>

<!-- =====================================================
     HOLD / PARKED ORDERS (MODAL)
===================================================== -->
<div id="holdModal" class="hold-overlay" style="
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  z-index:9998;
  align-items:flex-start;
  justify-content:center;
  padding-top:30px;
">
  <div class="hold-card">
    <div class="hold-head">
      <div class="hold-head-title">ğŸ—‚ Transaksi Tersimpan</div>
      <div class="hold-head-actions">
        <button class="btn-outline" onclick="refreshHoldList()">â†» Refresh</button>
        <button class="btn-outline" onclick="closeHoldModal()">Tutup</button>
      </div>
    </div>

    <!-- âœ… BODY SCROLL AREA -->
    <div class="hold-body">
      <div id="holdList" class="hold-list-box"></div>
    </div>

    <!-- âœ… FOOTER (TIPS) TETAP DI BAWAH -->
    <div class="hold-foot">
      Tips: Simpan transaksi saat customer masih pilih-pilih, supaya kasir bisa lanjut transaksi lain dulu.
    </div>
  </div>
</div>

<!-- MODAL BAYAR / CICIL PIUTANG -->
<div id="piutangPayModal" class="modal hidden">
  <div class="modal-box">
    <h3>Bayar / Cicil Piutang</h3>

    <div class="row">
      <label>Sisa Piutang</label>
      <input id="piutangSisa" type="text" disabled />
    </div>

    <div class="row">
      <label>Nominal Bayar</label>
      <input id="piutangBayar" type="number" min="0" />
      <div id="piutangError" class="error hidden">Nominal tidak valid</div>
    </div>

    <div class="row">
      <label>Metode Pembayaran</label>
      <select id="piutangMethod">
        <option value="">Pilih metode</option>
        <option value="Tunai">Tunai</option>
        <option value="Transfer BCA">Transfer BCA</option>
        <option value="Transfer Mandiri">Transfer Mandiri</option>
      </select>
    </div>

    <div class="row hidden" id="piutangBankRow">
      <label>Rekening Tujuan</label>
      <select id="piutangBankAccount">
        <option value="">Pilih rekening</option>
      </select>
      <div id="piutangBankError" class="error hidden">Pilih rekening tujuan</div>
    </div>


    <div class="actions">
      <button onclick="closePiutangModal()">Batal</button>
      <button onclick="submitPiutangPayment()">Simpan</button>
    </div>
  </div>
</div>
<!-- =========================
     MODAL: CLEANUP CANCELED ORDERS (ADMIN)
========================= -->
<div id="cleanupCanceledModal" class="modal hidden">
  <div class="modal-content" style="max-width:560px;">
    <div class="modal-header">
      <div class="modal-title">ğŸ§¹ Bersihkan Pesanan Dibatalkan</div>
      <button class="modal-close" type="button" onclick="closeCleanupCanceledModal()">âœ–</button>
    </div>

    <div class="modal-body">
      <div style="margin-top:6px;">
        <label style="display:block; font-weight:600; margin-bottom:6px;">PIN Admin</label>
        <input id="cleanupPinInput" type="password" placeholder="Masukkan PIN"
               style="width:100%; padding:10px; border:1px solid #ddd; border-radius:10px;">
      </div>

      <div style="margin-top:12px;">
        <label style="display:block; font-weight:600; margin-bottom:6px;">
          Daftar No Pesanan (1 baris 1 nomor, boleh koma)
        </label>
        <textarea id="cleanupOrdersTextarea" rows="8"
                  placeholder="TSJP-20260109-0759-0034
TSJP-20260109-0759-0035
TSJP-20260109-0759-0037"
                  style="width:100%; padding:10px; border:1px solid #ddd; border-radius:10px;"></textarea>

        <div style="font-size:12px; color:#6b7280; margin-top:6px;">
          Hanya akan menghapus order yang ada di <b>pos_canceled_orders</b>.
        </div>
      </div>

      <div class="cleanup-actions">
        <button class="btn-danger" type="button" onclick="runCleanupCanceledOrders()" style="flex:1;">
          Bersihkan
        </button>
        <button class="btn" type="button" onclick="closeCleanupCanceledModal()" style="flex:1;">
          Tutup
        </button>
      </div>

      <pre id="cleanupResultBox"
           style="margin-top:12px; background:#111; color:#fff; padding:10px; border-radius:10px; white-space:pre-wrap; display:none;"></pre>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="app.js"></script>
<script>
  (function () {
  if (!("serviceWorker" in navigator)) return;

  window.__POS_SW_UPDATED = false;

  navigator.serviceWorker.register("./sw.js").then((reg) => {

    // ==========================
    // âœ… AUTO-CHECK UPDATE (tanpa F5)
    // ==========================
    const __SW_CHECK_MS = 60 * 1000; // 1 menit (bisa 15*1000 untuk test cepat)
    setInterval(() => {
      try { reg.update(); } catch (e) {}
    }, __SW_CHECK_MS);

    window.addEventListener("focus", () => {
      try { reg.update(); } catch (e) {}
    });

    document.addEventListener("visibilitychange", () => {
      if (document.visibilityState === "visible") {
        try { reg.update(); } catch (e) {}
      }
    });
    // ==========================

    reg.addEventListener("updatefound", () => {
      const newWorker = reg.installing;
      if (!newWorker) return;

      newWorker.addEventListener("statechange", () => {
        if (newWorker.state === "installed") {
          // update (bukan first install)
          if (navigator.serviceWorker.controller) {
            window.__POS_SW_UPDATED = true;

            // âœ… aman: tanya dulu, jangan auto reload saat kasir transaksi
            const ok = confirm("Ada versi baru Tasaji POS. Muat ulang sekarang?");
            if (ok) newWorker.postMessage({ type: "SKIP_WAITING" });
          }
        }
      });
    });

    navigator.serviceWorker.addEventListener("controllerchange", () => {
      if (window.__POS_SW_UPDATED) location.reload();
    });

  }).catch((err) => {
    console.warn("SW register failed:", err);
  });
})();

</script>

</body>
</html>
